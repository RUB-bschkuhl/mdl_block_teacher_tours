/**
* JavaScript for handling tour creation via button click.
*
* @module block_teacher_tours/teacher_tours
* @copyright 2025 Your Name <your.email@example.com>
* @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/
define("block_teacher_tours/teacher_tours",["jquery","core/ajax","core/str"],(function($,Ajax,Str){let tourObject={steps:[],name:"",description:"",pathmatch:"",enabled:"",filter_values:"",sortorder:""},currentStepObject={};const startEditor=function(){$("#start-tour-creation").hide(),$("#step-creation").hide(),$("#tour-editor").show(),highlightElements()},showCurrentStepIndicator=function(elementText){$("#current-step-element").text(elementText),$("#current-step-indicator").show()},hideCurrentStepIndicator=function(){$("#current-step-indicator").hide()},resetCurrentStepObject=function(){currentStepObject={}},tourEventHandlers_sectionClick=function(e){e.preventDefault(),e.stopPropagation();const section=e.currentTarget;currentStepObject={targettype:"2",targetvalue:"#"+section.getAttribute("id"),placement:"right",orphan:"false",backdrop:"true",reflex:"false"},showCurrentStepIndicator("Section: "+section.getAttribute("data-sectionname")),removeHighlighting(),startTextEditor()},tourEventHandlers_moduleClick=function(e){e.preventDefault(),e.stopPropagation();const mod=e.currentTarget;currentStepObject={targettype:"2",targetvalue:"#"+mod.getAttribute("id"),placement:"right",orphan:"false",backdrop:"true",reflex:"false"},showCurrentStepIndicator("Module: "+mod.childNodes[1].getAttribute("data-activityname")),removeHighlighting(),startTextEditor()},highlightElements=function(){document.querySelectorAll('[id^="section-"]').forEach((section=>{section.classList.add("section-highlight"),section.addEventListener("click",tourEventHandlers_sectionClick)})),document.querySelectorAll('[id^="module-"]').forEach((mod=>{mod.classList.add("module-highlight"),mod.addEventListener("click",tourEventHandlers_moduleClick)}))},startTextEditor=function(){$("#text-editor").show(),clearTextEditor(),$("#save-tour").hide(),$("#step-title").focus()},clearTextEditor=function(){$("#step-title").val(""),$("#step-content").val("")},removeHighlighting=function(){document.querySelectorAll('[id^="section-"]').forEach((section=>{section.classList.remove("section-highlight"),section.removeEventListener("click",tourEventHandlers_sectionClick)})),document.querySelectorAll('[id^="module-"]').forEach((mod=>{mod.classList.remove("module-highlight"),mod.removeEventListener("click",tourEventHandlers_moduleClick)}))},saveTour=function(){$("#save-tour").prop("disabled",!0).text("Saving..."),Ajax.call([{methodname:"block_teacher_tours_save_tour",args:{tour:tourObject}}])[0].then((function(response){response||"ok"!==!response.status||alert("Error saving tour: "+(response.message||"Unknown error")),resetTourObject(),$("#tour-editor").hide(),$("#start-tour-creation").show(),$("#step-creation").show(),hideCurrentStepIndicator(),clearTextEditor(),removeHighlighting(),$(".tour-preview").html(""),Str.get_string("savetour","block_teacher_tours").then((function(text){$("#save-tour").prop("disabled",!1).html('<i class="fa fa-save"></i> '+text)}))}))},resetTourObject=function(courseid){tourObject={steps:[],name:"tour for course "+courseid,description:"A tour for course "+courseid,pathmatch:"/course/view.php?id="+courseid,enabled:"",filter_values:"",sortorder:""}},addStep=function(stepData){tourObject.steps.push(stepData||{})},saveStep=function(){const title=$("#step-title").val(),content=$("#step-content").val();currentStepObject.title=title,currentStepObject.content=content,addStep(currentStepObject)},initializeEventBindings=function(){$(document).on("click","#start-tour-creation",(function(e){e.preventDefault(),startEditor()})),$(document).on("click","#save-tour",(function(e){e.preventDefault(),saveTour()})),$(document).on("click","#save-step",(function(e){e.preventDefault(),saveStep(),$("#text-editor").hide(),$("#save-tour").show(),$(".tour-preview").html(""),tourObject.steps.forEach(((step,index)=>{$(".tour-preview").append('<div class="tour-step-preview">Step '+(index+1)+"<strong> "+step.targetvalue+":</strong> "+step.title+"</div>")})),hideCurrentStepIndicator(),resetCurrentStepObject(),startEditor()})),$(document).on("click","#cancel-step-edit",(function(e){e.preventDefault(),hideCurrentStepIndicator(),resetCurrentStepObject(),$("#text-editor").hide(),startEditor()})),$(document).on("click","#cancel-tour-creation",(function(e){e.preventDefault(),$("#tour-editor").hide(),$("#start-tour-creation").show(),hideCurrentStepIndicator(),resetTourObject(),$(".tour-preview").html("")})),$(document).on("click","#step-creation",(function(){startEditor()}))};return{currentStepObject:currentStepObject,tourObject:tourObject,init:function(courseid){initializeEventBindings(),resetTourObject(courseid)},startEditor:startEditor,resetTourObject:resetTourObject,addStep:addStep,saveStep:saveStep,saveTour:saveTour,startTextEditor:startTextEditor,highlightElements:highlightElements,initializeEventBindings:initializeEventBindings}}));

//# sourceMappingURL=teacher_tours.min.js.map