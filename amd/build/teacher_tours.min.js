/**
 * JavaScript for handling tour creation via button click.
 *
 * @module block_teacher_tours/teacher_tours
 * @copyright 2025 Your Name <your.email@example.com>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_teacher_tours/teacher_tours",["jquery","core/ajax","core/str"],(function($,Ajax,Str){let tourObject={steps:[],name:"",description:"",pathmatch:"",enabled:"",filter_values:"",sortorder:""},stickyTarget=null,sticky=!1,currentStepObject={};const startEditor=function(){$("#start-tour-creation").hide(),$("#start-sticky-creation").hide(),$("#step-creation").hide(),$("#tour-editor").show(),sticky?highlightPlacements():highlightElements()},showCurrentStepIndicator=function(elementText){$("#current-step-element").text(elementText),$("#current-step-indicator").show()},hideCurrentStepIndicator=function(){$("#current-step-indicator").hide()},resetCurrentStepObject=function(){currentStepObject={}},tourEventHandlers_stickySelectClick=function(e){e.preventDefault(),e.stopPropagation();const element=e.currentTarget;element.classList.contains("section-sticky-highlight")?(element.classList.remove("section-sticky-highlight"),element.classList.add("section-sticky-button"),Str.get_string("selectplacement","block_teacher_tours").then((function(text){element.html(text)}))):element.classList.contains("header-sticky-highlight")&&(element.classList.remove("header-sticky-highlight"),element.classList.add("header-sticky-button"),Str.get_string("selectplacement","block_teacher_tours").then((function(text){element.html(text)})));let parent=element.parentElement;stickyTarget=parent.getAttribute("id"),removeHighlighting(),sticky=!1,highlightElements()},tourEventHandlers_sectionClick=function(e){e.preventDefault(),e.stopPropagation();const section=e.currentTarget;currentStepObject={targettype:"0",targetvalue:"#"+section.getAttribute("id"),placement:"right",orphan:"false",backdrop:"true",reflex:"false"},showCurrentStepIndicator("Section: "+section.getAttribute("data-sectionname")),removeHighlighting(),startTextEditor()},tourEventHandlers_moduleClick=function(e){e.preventDefault(),e.stopPropagation();const mod=e.currentTarget;currentStepObject={targettype:"0",targetvalue:"#"+mod.getAttribute("id"),placement:"right",orphan:"false",backdrop:"true",reflex:"false"},showCurrentStepIndicator("Module: "+mod.childNodes[1].getAttribute("data-activityname")),removeHighlighting(),startTextEditor()},highlightElements=function(){document.querySelectorAll('[id^="section-"]').forEach((section=>{section.classList.add("section-highlight"),section.addEventListener("click",tourEventHandlers_sectionClick)})),document.querySelectorAll('[id^="module-"]').forEach((mod=>{mod.classList.add("module-highlight"),mod.addEventListener("click",tourEventHandlers_moduleClick)}))},highlightPlacements=function(){Str.get_string("selectplacement","block_teacher_tours").then((function(text){document.querySelectorAll('[id^="section-"]').forEach((section=>{const button=document.createElement("button");button.className="btn btn-sm btn-outline-primary section-sticky-highlight",button.textContent=text+" ";const icon=document.createElement("i");icon.className="fa fa-question-circle",button.append(icon),section.style.position="relative",section.prepend(button),button.addEventListener("click",tourEventHandlers_stickySelectClick)})),document.querySelectorAll('[id="page-header"]').forEach((mod=>{const button=document.createElement("button");button.className="btn btn-sm btn-outline-primary header-sticky-highlight",button.textContent=text+" ";const icon=document.createElement("i");icon.className="fa fa-question-circle",button.append(icon),mod.style.position="relative",mod.prepend(button),button.addEventListener("click",tourEventHandlers_stickySelectClick)}))}))},startTextEditor=function(){$("#text-editor").show(),clearTextEditor(),$("#save-tour").hide(),$("#step-title").focus()},clearTextEditor=function(){$("#step-title").val(""),$("#step-content").val("")},removeHighlighting=function(){sticky?(document.querySelectorAll(".section-sticky-highlight").forEach((section=>{section.remove()})),document.querySelectorAll(".header-sticky-highlight").forEach((mod=>{mod.remove()}))):(document.querySelectorAll('[id^="section-"]').forEach((section=>{section.classList.remove("section-highlight"),section.removeEventListener("click",tourEventHandlers_sectionClick)})),document.querySelectorAll('[id^="module-"]').forEach((mod=>{mod.classList.remove("module-highlight"),mod.removeEventListener("click",tourEventHandlers_moduleClick)})))},saveTour=function(){$("#save-tour").prop("disabled",!0).text("Saving...");let argsObj={};argsObj=stickyTarget?{tour:tourObject,stickytarget:stickyTarget}:{tour:tourObject},Ajax.call([{methodname:"block_teacher_tours_save_tour",args:argsObj}])[0].then((function(response){response||"ok"!==!response.status||alert("Error saving tour: "+(response.message||"Unknown error")),resetTourObject(),$("#tour-editor").hide(),$("#start-tour-creation").show(),$("#start-sticky-creation").show(),$("#step-creation").show(),hideCurrentStepIndicator(),clearTextEditor(),removeHighlighting(),$(".tour-preview").html(""),$(".tour-preview").hide(),Str.get_string("savetour","block_teacher_tours").then((function(text){$("#save-tour").prop("disabled",!1).html('<i class="fa fa-save"></i> '+text)}))}))},resetTourObject=function(courseid){stickyTarget=null,sticky=!1,tourObject={steps:[],name:"tour for course "+courseid,description:"A tour for course "+courseid,pathmatch:"/course/view.php?id="+courseid,enabled:"",filter_values:"",sortorder:""}},addStep=function(stepData){tourObject.steps.push(stepData||{})},saveStep=function(){const title=$("#step-title").val(),content=$("#step-content").val();currentStepObject.title=title,currentStepObject.content=content,addStep(currentStepObject)},initializeEventBindings=function(){$(document).on("click","#start-tour-creation",(function(e){e.preventDefault(),startEditor()})),$(document).on("click","#start-sticky-creation",(function(e){e.preventDefault(),sticky=!0,startEditor()})),$(document).on("click","#save-tour",(function(e){e.preventDefault(),saveTour()})),$(document).on("click","#save-step",(function(e){e.preventDefault(),saveStep(),$("#text-editor").hide(),$("#save-tour").show(),$(".tour-preview").html(""),tourObject.steps.forEach(((step,index)=>{$(".tour-preview").append('<div class="tour-step-preview">Step '+(index+1)+" <strong> "+step.targetvalue+":</strong> "+step.title+"</div>")})),$(".tour-preview").show(),hideCurrentStepIndicator(),resetCurrentStepObject(),startEditor()})),$(document).on("click","#cancel-step-edit",(function(e){e.preventDefault(),hideCurrentStepIndicator(),resetCurrentStepObject(),$("#text-editor").hide(),startEditor()})),$(document).on("click","#cancel-tour-creation",(function(e){e.preventDefault(),$("#tour-editor").hide(),$("#start-sticky-creation").show(),$("#start-tour-creation").show(),hideCurrentStepIndicator(),resetTourObject(),$(".tour-preview").html(""),$(".tour-preview").hide()})),$(document).on("click","#step-creation",(function(){startEditor()})),$(document).on("change",".tour-toggle",(function(){!function(tourId,enabled){Ajax.call([{methodname:"block_teacher_tours_toggle_tour_enabled",args:{tourid:tourId,enabled:enabled}}])[0].done((function(response){if(response.success){const tourCard=$(`[data-tour-id="${tourId}"]`),statusElement=tourCard.find(".tour-status");response.enabled?(Str.get_string("enabled","block_teacher_tours").then((function(enabledText){statusElement.html('<i class="fa fa-check-circle text-success"></i> '+enabledText)})),tourCard.find(".tour-toggle").prop("checked",!0)):(Str.get_string("disabled","block_teacher_tours").then((function(disabledText){statusElement.html('<i class="fa fa-times-circle text-muted"></i> '+disabledText)})),tourCard.find(".tour-toggle").prop("checked",!1))}else $(`[data-tour-id="${tourId}"]`).find(".tour-toggle").prop("checked",!enabled),alert("Failed to update tour status. Please try again.")})).fail((function(){$(`[data-tour-id="${tourId}"]`).find(".tour-toggle").prop("checked",!enabled),alert("Error updating tour status. Please try again.")}))}($(this).data("tour-id"),$(this).is(":checked"))})),$(document).on("click",".edit-tour",(function(e){e.preventDefault();!function(tourId){alert("Edit functionality will be implemented when backend is ready. Tour ID: "+tourId)}($(this).data("tour-id"))})),$(document).on("click",".delete-tour",(function(e){e.preventDefault();!function(tourId){confirm("Are you sure you want to delete this tour? This action cannot be undone.")&&Ajax.call([{methodname:"block_teacher_tours_delete_tour",args:{tourid:tourId}}])[0].done((function(response){response.success?$(`[data-tour-id="${tourId}"]`).fadeOut(300,(function(){$(this).remove(),0===$(".tour-card").length&&$(".existing-tours").hide()})):alert("Failed to delete tour. Please try again.")})).fail((function(){alert("Error deleting tour. Please try again.")}))}($(this).data("tour-id"))}))};return{sticky:sticky,currentStepObject:currentStepObject,tourObject:tourObject,init:function(courseid){initializeEventBindings(),resetTourObject(courseid)},startEditor:startEditor,resetTourObject:resetTourObject,addStep:addStep,saveStep:saveStep,saveTour:saveTour,startTextEditor:startTextEditor,highlightElements:highlightElements,initializeEventBindings:initializeEventBindings}}));

//# sourceMappingURL=teacher_tours.min.js.map